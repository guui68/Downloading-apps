<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>GX Admin Pro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; }
        .admin-box { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { background: #01875f; color: white; border: none; font-weight: bold; cursor: pointer; }
        .item-card { background: #fff; border: 1px solid #eee; padding: 10px; margin-bottom: 8px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .edit-btn { background: #ff9800; width: auto; padding: 5px 10px; font-size: 12px; margin-right: 5px; }
        .del-btn { background: #f44336; width: auto; padding: 5px 10px; font-size: 12px; }
    </style>
</head>
<body>
<div class="admin-box">
    <h2>Admin Panel</h2>
    <input type="hidden" id="editIdx" value="-1">
    <input type="text" id="title" placeholder="টাইটেল">
    <input type="text" id="link" placeholder="লিঙ্ক">
    <select id="cat">
        <option value="app">App</option>
        <option value="file">File</option>
    </select>
    <button id="mainBtn" onclick="save()">সেভ করুন</button>
    <div id="list">লোড হচ্ছে...</div>
</div>

<script>
    const TOKEN = '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';
    const URL = 'https://api.github.com/repos/guui68/Downloading-apps/contents/data.json';
    let items = [], sha = '';

    async function load() {
        const res = await fetch(URL, { headers: { 'Authorization': `token ${TOKEN}` }, cache: "no-store" });
        const data = await res.json();
        sha = data.sha;
        items = JSON.parse(decodeURIComponent(escape(atob(data.content))));
        render();
    }

    function render() {
        const listDiv = document.getElementById('list');
        listDiv.innerHTML = '<h4>লিস্ট:</h4>';
        items.forEach((it, idx) => {
            listDiv.innerHTML += `
                <div class="item-card">
                    <div><b>${it.title}</b></div>
                    <div>
                        <button class="edit-btn" onclick="edit(${idx})">Edit</button>
                        <button class="del-btn" onclick="del(${idx})">Del</button>
                    </div>
                </div>`;
        });
    }

    async function save() {
        const title = document.getElementById('title').value;
        const link = document.getElementById('link').value;
        const cat = document.getElementById('cat').value;
        const idx = parseInt(document.getElementById('editIdx').value);

        if(!title || !link) return alert("তথ্য দিন!");

        if(idx === -1) {
            items.push({ title, link, cat, color: '#'+Math.floor(Math.random()*16777215).toString(16) });
        } else {
            items[idx] = { ...items[idx], title, link, cat };
        }
        update();
    }

    function edit(idx) {
        document.getElementById('title').value = items[idx].title;
        document.getElementById('link').value = items[idx].link;
        document.getElementById('cat').value = items[idx].cat;
        document.getElementById('editIdx').value = idx;
        document.getElementById('mainBtn').innerText = "আপডেট করুন";
    }

    async function del(idx) {
        if(confirm("ডিলিট করবেন?")) {
            items.splice(idx, 1);
            update();
        }
    }

    async function update() {
        const res = await fetch(URL, {
            method: 'PUT',
            headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({
                message: "Update Content",
                content: btoa(unescape(encodeURIComponent(JSON.stringify(items, null, 2)))),
                sha: sha
            })
        });
        if(res.ok) { alert("সফল হয়েছে!"); location.reload(); }
    }
    load();
</script>
</body>
</html>
